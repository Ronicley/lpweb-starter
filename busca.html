<!--
/**
 * Created by PhpStorm.
 * User: laercio
 * Date: 07/02/17
 * Time: 04:11
 **/
 -->

<!DOCTYPE html>
<html lang="pt_br">
<head>
    <meta charset="UTF-8">
    <title>Eventos - Lista e Filtros JavaScript</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body onload="mostrarEventos()">
<div class="container-fluid">
    <h1>Eventos</h1>
    <hr>
    <form action="">
        <div class="col-md-12">
            <blockquote>
                <p>Pesquise um Evento</p>
            </blockquote>
        </div>
        <div class="col-md-12">
            <div class="form-group">
                <input type="text" class="form-control" name="busca_nome" id="busca_nome" placeholder="Pesquise por um evento" onKeyUp="mostrarEventos()"><!--Obs onKeyUp é um evento que chama a fução conforme o input recever informações do teclado-->
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <input type="text" class="form-control" name="busca_data_ini" id="busca_data_ini" placeholder="informe a data inicial - 00/00/0000" onKeyUp="mostrarEventos()">
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <input type="text" class="form-control" name="busca_data_fim" id="busca_data_fim" placeholder="informe a data final - 00/00/0000" onKeyUp="mostrarEventos()">
            </div>
        </div>
    </form>
    <hr>
    <div class="col-md-12">
        <div id="lista"></div>
    </div>
</div>

<script>

    //Apenas o objeto com as informações dos eventos
    var eventos = [
        {
            id: 1,
            nome: 'ENCOINFO 2017',
            inicio: "10/02/2017",
            fim: '13/02/2017'
        },
        {
            id: 2,
            nome: 'SBSI',
            inicio: '10/03/2017',
            fim: '13/03/2017'
        },
        {
            id: 3,
            nome: 'CSBC',
            inicio: '10/04/2017',
            fim: '13/04/2017'
        },
        {
            id: 4,
            nome: 'EVENTO TESTE 2',
            inicio: "10/02/2017",
            fim: '13/02/2017'
        },
        {
            id: 5,
            nome: 'EVENTO 3',
            inicio: '10/03/2017',
            fim: '13/03/2017'
        },
        {
            id: 6,
            nome: 'EVENTO 4',
            inicio: '10/04/2017',
            fim: '13/04/2017'
        }
    ];
    function mostrarEventos(){
        var table = document.getElementById('lista'); //Pega o elemento identificado por id="lista"
        var tabela = document.createElement("table"); //adiciona table ao DOM para mais tarde exibir
        var thead = document.createElement("thead"); //adiciona table ao DOM para mais tarde exibir
        var tbody = document.createElement("tbody"); //adiciona table ao DOM para mais tarde exibir

        //atribui as variáveis os valores dos inputs usando expressão regular (RegExp)
        var busca_nome = new RegExp(document.getElementById('busca_nome').value,"igm");
        var busca_data_ini = new RegExp(document.getElementById('busca_data_ini').value,"igm");
        var busca_data_fim = new RegExp(document.getElementById('busca_data_fim').value,"igm");

        document.getElementById('lista').innerHTML = '';
        var resultado = 0;

        /*Estrutura o head da tabela*/
        var tr_titulo = document.createElement('tr');
        var titulo_id = document.createElement('th');
        var titulo_nome = document.createElement('th');
        var titulo_inicio = document.createElement('th');
        var titulo_fim = document.createElement('th');

        titulo_id.innerHTML = "id";
        titulo_nome.innerHTML = "Titulo do Evento";
        titulo_inicio.innerHTML = "Data de inicio";
        titulo_fim.innerHTML = "Data de encerramento";

        tr_titulo.appendChild(titulo_id);
        tr_titulo.appendChild(titulo_nome);
        tr_titulo.appendChild(titulo_inicio);
        tr_titulo.appendChild(titulo_fim);
        tabela.appendChild(thead);
        thead.appendChild(tr_titulo);
        /*Fim*/

        for(var i = 0; i < eventos.length; i++){
            var tr = document.createElement('tr');
            if(eventos[i].nome.match(busca_nome)) { //verifica se o valor passado no input coincide com algum valor na propriedade nome
                if(eventos[i].inicio.match(busca_data_ini)) { //verifica se o valor passado no input coincide com algum valor na propriedade inicio
                    if(eventos[i].fim.match(busca_data_fim)) { //verifica se o valor passado no input coincide com algum valor na propriedade Fim
                        var evento = eventos[i]; //exibe as informações no objeto na posição [i]
                        /*cria elementos e referencia a uma variável*/
                        var id = document.createElement('th');
                        var nome = document.createElement('td');
                        var inicio = document.createElement('td');
                        var fim = document.createElement('td');
                        /*Fim*/
                        /*Atribui valores ao DOM*/
                        id.innerHTML = evento.id;
                        nome.innerHTML = evento.nome;
                        inicio.innerHTML = evento.inicio;
                        fim.innerHTML = evento.fim;
                        /*Fim*/
                        /*Exibe valores*/
                        tr.appendChild(id);
                        tr.appendChild(nome);
                        tr.appendChild(inicio);
                        tr.appendChild(fim);
                        tabela.appendChild(tbody);
                        tbody.appendChild(tr);
                        /*Fim*/
                        resultado = 1; //Caso entre aqui é porque encontrou um resultado e altera o result para 1.
                    }
                }
            }
        }
        //Verifica se não encontrou nenhum resultado e exibe uma mensagem.
        if(resultado == 0){
            console.log("nada...");
            var td = document.createElement('td');
            td.innerHTML = "Nenhum Resultado encontrado...";
            tabela.appendChild(tr);
            tr.appendChild(td);
        }
        tabela.setAttribute('class', 'table table-striped');
        table.appendChild(tabela);
    }
</script>
</body>
</html>